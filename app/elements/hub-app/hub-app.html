<dom-module id="hub-app">
  <link rel="import" type="css" href="hub-app.css"/>

  <template>

    <paper-drawer-panel id="drawerPanel" responsive-width="1920px" drawer-width="{{drawerWidth}}">

      <paper-header-panel class="list-panel" drawer mode="seamed">

        <!-- List Toolbar -->
        <paper-toolbar class$="{{toolbarClass}}"></paper-toolbar>

        <!-- List -->
        <paper-menu class="list" on-tap="_listTap">
          <a href="/devices" data-route="devices">
            <span><iron-icon icon="settings-remote"></iron-icon>Devices</span>
            <paper-ripple></paper-ripple>
          </a>
          <a href="/groups" data-route="groups">
            <span><iron-icon icon="group-work"></iron-icon>Groups</span>
            <paper-ripple></paper-ripple>
          </a>
          <a href="/settings" data-route="settings">
            <span><iron-icon icon="settings"></iron-icon>Settings</span>
            <paper-ripple></paper-ripple>
          </a>
          <a href="" on-tap="_logout">
            <span><iron-icon icon="open-in-new"></iron-icon>Logout</span>
            <paper-ripple></paper-ripple>
          </a>
        </paper-menu>

      </paper-header-panel>

      <paper-header-panel class="main-panel" main mode="{{mainMode}}">

        <!-- Main Toolbar -->
        <paper-toolbar class$="{{toolbarClass}}">
          <paper-icon-button icon="menu" paper-drawer-toggle></paper-icon-button>
        </paper-toolbar>

        <div class="content">
            <neon-animated-pages id="pages"
                                 selected="{{route}}"
                                 attr-for-selected="data-route"
                                 entry-animation="slide-from-right-animation"
                                 exit-animation="slide-left-animation">

              <paper-material data-route="devices" elevation="3">
                <devices-page device="{{device}}" user="{{user}}"></devices-page>
              </paper-material>

              <paper-material data-route="device-info" elevation="3">
                <device-info-page  device="{{device}}"></device-info-page>
              </paper-material>

              <paper-material data-route="settings" elevation="3">
                <settings-page  settings="{{settings}}"></settings-page>
              </paper-material>

            </neon-animated-pages>
        </div>

      </paper-header-panel>

    </paper-drawer-panel>

    <iron-media-query query="(max-width: 1024px)" query-matches="{{_isMobile}}"></iron-media-query>

  </template>

  <script>
    Polymer({
      is: 'hub-app',
      properties: {
        _isMobile: {
          type: Boolean,
          observer: '_isMobileChanged'
        },

        device: {
          notify: true
        }
      },

      listeners: {
        'device-changed': '_deviceChanged'
      },

      showDevice: function() {
        app.route = 'device-info';
      },

      showDevicesPage: function() {
        app.route = 'devices';
      },

      _listTap: function(e, obj) {
        this.$.drawerPanel.closeDrawer();
      },

      _logout: function(e) {
        e.stopPropagation();

        // TODO: Do logout;
        console.log('logged out!');
      },

      _isMobileChanged: function(isMobile) {
        this.mainMode = isMobile ? 'seamed' : 'cover';
        this.drawerWidth = isMobile ? '100%' : '320px';
        this.toolbarClass = isMobile ? '' : 'tall';
        this.updateStyles();
      },

      _deviceChanged: function(e) {
        if (e.detail.value) {
          this.showDevice();
        } else {
          this.showDevicesPage();
        }
      }
    });
  </script>
</dom-module>
